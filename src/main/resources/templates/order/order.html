<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/basic :: setContent(~{this::contentFrag})}">
    <th:block th:fragment="contentFrag">

    <article id="article">
        <div class="join_box">
            <h2><span>USER</span>님의 주문내역입니다.</h2>
            <div class="order_info" th:if="${not #lists.isEmpty(cartProduct)}" th:each="dto:${cartProduct}">
                <div class="orders">
                   <input type="hidden" class="memberId" th:value="${dto.cart.member.id}">
                    <input type="hidden" class="productId" th:value="${dto.products.id}">
                    <p>상품명: <span>[[${dto.products.productName}]]</span></p>
                    <p>가격 : <span>[[${dto.products.productPrice}]]</span></p>
                    <p>주문수량 : <span>[[${dto.count}]]</span></p>
                </div>
            </div> 

            <h3 style="text-align:right; margin-right: 10px;">총 결제금액 : 원</h3>

            <button class="cancle-btn">C A N C L E</button>
            <button class="orderBtn" style="width: 300px; margin-left: 500px; margin-bottom: 50px;" >N A V E R  P A Y</button>
        </div>


    </article>

    <!-- article -->

    </th:block>
</th:block>
<script src="https://kit.fontawesome.com/d2cac4190c.js" crossorigin="anonymous"></script>
<script>
    const cancleBtn = document.querySelector('.cancle-btn');
    const orderBtn = document.querySelector('.orderBtn');
    let productIds = Array.from(document.querySelectorAll('.productId'));

    var arr = []; 
    for (var i = 0; i < productIds.length; i++) {
        arr.push(document.querySelectorAll('.productId').values);
    }
  

    if(cancleBtn){
        cancleBtn.addEventListener('click',event=>{
            if(confirm('결제를 취소하시겠습니까?')){
             location.replace('/');
            }
        })
    }
    if(orderBtn){
        orderBtn.addEventListener('click', event => {
            fetch('/api/order',{
                method:'POST',
                headers:{
                    "Content-Type" : "application/json",
                },
                body: JSON.stringify({
                    memberId : 1,
                    productId : productIds
                })
            })
            .then(()=>{
                alert('결제가 완료되었습니다.');
                location.replace('/order/complete/1');
            });
        })
    }
 </script>
</html>